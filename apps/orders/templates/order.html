{% extends "base.html" %}

{% block title %}Order {{ order.id }}{% endblock %}

{% block content %}
<h2>Order #{{ order.id }}</h2>

<ul class="list-group mb-3">
    {% for oi in order.items.all %}
    <li class="list-group-item d-flex justify-content-between">
        <div>
            {{ oi.item.name }} Ã— {{ oi.quantity }}
        </div>
        <strong>{{ oi.item.price_display|floatformat:2 }} $</strong>
    </li>
    {% endfor %}
</ul>

<button id="pay-button" class="btn btn-success w-100">
    Pay Order
</button>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe("{{ stripe_public_key }}");

    document.getElementById("pay-button").addEventListener("click", function () {
        fetch("/orders/buy-order/{{ order.id }}/")
            .then(r => r.json())
            .then(data => stripe.redirectToCheckout({ sessionId: data.id }));
    });
</script>
{% endblock %}
